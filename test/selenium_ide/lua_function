<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://selenium-ide.openqa.org/profiles/test-case">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="selenium.base" href="http://wiki.serverdev-mediawiki-v1/" />
<title>lua_function</title>
</head>
<body>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">lua_function</td></tr>
</thead><tbody>
<tr>
	<td>store</td>
	<td>javascript{&quot;TestPage&quot;+Math.random()}</td>
	<td>Title</td>
</tr>
<tr>
	<td>open</td>
	<td>/index.php?title=Module:LinkedWikiTest${Title}&amp;action=edit</td>
	<td></td>
</tr>
<tr>
	<td>type</td>
	<td>id=wpTextbox1</td>
	<td>-- @copyright (c) 2016 Bourdercloud.com<br/>-- @author Karima Rafes <karima.rafes@bordercloud.com><br/>-- @link http://www.mediawiki.org/wiki/Extension:LinkedWiki<br/>-- @license CC-by-nc-sa V3.0<br/>--<br/>--  Last version : http://github.com/BorderCloud/LinkedWiki<br/>--<br/>--<br/>-- This work is licensed under the Creative Commons<br/>-- Attribution-NonCommercial-ShareAlike 3.0<br/>-- Unported License. To view a copy of this license,<br/>-- visit http://creativecommons.org/licenses/by-nc-sa/3.0/<br/>-- or send a letter to Creative Commons,<br/>-- 171 Second Street, Suite 300, San Francisco,<br/>-- California, 94105, USA.<br/><br/>-- @copyright (c) 2016 Bourdercloud.com<br/>-- @author Karima Rafes <karima.rafes@bordercloud.com><br/>-- @link http://www.mediawiki.org/wiki/Extension:LinkedWiki<br/>-- @license CC-by-nc-sa V3.0<br/>--<br/>--  Last version : http://github.com/BorderCloud/LinkedWiki<br/>--<br/>--<br/>-- This work is licensed under the Creative Commons<br/>-- Attribution-NonCommercial-ShareAlike 3.0<br/>-- Unported License. To view a copy of this license,<br/>-- visit http://creativecommons.org/licenses/by-nc-sa/3.0/<br/>-- or send a letter to Creative Commons,<br/>-- 171 Second Street, Suite 300, San Francisco,<br/>-- California, 94105, USA.<br/><br/>--[[<br/>-- Debug console<br/><br/>frame = mw.getCurrentFrame() -- Get a frame object<br/>newFrame = frame:newChild{ -- Get one with args<br/>	title = 'test' ,<br/> args = {<br/> iri = 'http://daap.eu/wiki/Lip(Sys)2/RamanEvolution_Spectrometer'<br/>    }<br/>}<br/><br/>mw.log(p.tests(newFrame) )<br/>]]<br/><br/>local p = {}<br/><br/>function p.checkLitteral(query, litteral)<br/>    local result = ''<br/>    if string.match(query, litteral) then<br/>        result = "OK"<br/>    else<br/>        result = "KO"<br/>    end<br/>    return result<br/>end<br/><br/><br/>function p.checkString(val1, val2)<br/>    local result = ''<br/>    if (val1 ==  nil or val2 ==  nil) then<br/>        result = "KO1"<br/>    else<br/>        if val1 ==  val2 then<br/>            result = "OK"<br/>        else<br/>            result = "KO2"<br/>        end<br/>    end<br/>    return result<br/>end<br/>function p.checkNumber(val1, val2)<br/>    local result = ''<br/>    if (val1 ==  nil or val2 ==  nil) then<br/>        result = "KO"<br/>    else<br/>        if tonumber(val1) ==  tonumber(val2) then<br/>            result = "OK"<br/>        else<br/>            result = "KO"<br/>        end<br/>    end<br/>    return result<br/>end<br/><br/><br/>function p.tests(f)<br/><br/>    local linkedwiki = require 'linkedwiki'<br/>    local endpoint = 'http://database-test:8890/sparql'<br/>    local config = 'http://database-test/data'<br/><br/><br/>    local xsd = 'http://www.w3.org/2001/XMLSchema#'<br/>    local rdfs = 'http://www.w3.org/2000/01/rdf-schema#'<br/>    local wdt = 'http://www.wikidata.org/prop/direct/'<br/><br/>    local pr = 'http://database-test/TestFunction:'<br/><br/>    local html = '== TESTS =='.. '\n'<br/><br/>    --linkedwiki.setDebug(true)<br/><br/>    local subject = f.args.iri or linkedwiki.getCurrentIRI();<br/>    html = html .."TEST : f.args.iri or linkedwiki.getCurrentIRI()" .. '\n'<br/>    html = html .."RESULT : " .. subject .. '\n'<br/><br/>local subject = linkedwiki.getCurrentIRI()<br/><br/><br/>local objTest = linkedwiki.new(subject,config)<br/>    local pTObjTemp1 = mw.title.new("Title1"):fullUrl()<br/>    local pTObjTemp2 = mw.title.new("Title2"):fullUrl()<br/><br/>    local ObjTemp1 = linkedwiki.new(pTObjTemp1);<br/>    local ObjTemp2 = linkedwiki.new(pTObjTemp2);<br/><br/><br/><br/>    mw.log(objTest:removeSubject())<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkValue" ..'\n'<br/>    --    function linkedwiki.checkValue(property, valueInWiki)<br/>    local valueInWiki = 0<br/>    local result = ""<br/>    local pT =""<br/><br/>    pT = pr..'1'<br/><br/>    valueInWiki = "1"<br/>    result = objTest:checkValue(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value">1</div>') ..'\n'<br/><br/>    mw.log(objTest:addPropertyWithLitteral(pT,1))<br/><br/>    valueInWiki = "1"<br/>    result = objTest:checkValue(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">1</div>') ..'\n'<br/><br/>    valueInWiki = "2"<br/>    result =objTest:checkValue(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : 1">2</div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkString" ..'\n'<br/>--    function objTest:checkString(property, valueInWiki, tagLang)<br/><br/>    pT = pr..'2'<br/>    valueInWiki = "test"<br/>    result = objTest:checkString(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value">test</div>') ..'\n'<br/><br/>    --mw.log(objTest:addPropertyWithLitteral(pT,"test"))<br/>    mw.log(objTest:addPropertyString(pT,"test"))<br/><br/>    valueInWiki = "test"<br/>    result = objTest:checkString(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">test</div>') ..'\n'<br/><br/>    valueInWiki = "testDifferent"<br/>    result = objTest:checkString(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : test">testDifferent</div>') ..'\n'<br/><br/><br/>    --mw.log(objTest:addPropertyWithLitteral(pT,"testfr",nil,"fr"))<br/>    mw.log(objTest:addPropertyString(pT,"testfr","fr"))<br/><br/>    valueInWiki = "testfr"<br/>    result = objTest:checkString(pT,valueInWiki,"fr")<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" .. '\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">testfr</div>') ..'\n'<br/><br/>    valueInWiki = "testfrDifferent"<br/>    result = objTest:checkString(pT,valueInWiki,"fr")<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : testfr">testfrDifferent</div>') ..'\n'<br/><br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkLabelOfInternLink" ..'\n'<br/>    --  function objTest:checkLabelOfInternLink(link, propertyOfLabel, labelInWiki, tagLang)<br/><br/>    pT = pr..'3'<br/>    valueInWiki = "test"<br/>    local link = "http://example.com/link"<br/>    result = objTest:checkLabelOfInternLink(link,pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value"><span class="plainlinks">[http://example.com/link test]</span></div>') ..'\n'<br/><br/>    mw.log(objTest:addPropertyWithLitteral(pT,"test"))<br/><br/>    valueInWiki = "test"<br/>    result = objTest:checkLabelOfInternLink(link,pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://example.com/link test]</span></div>') ..'\n'<br/><br/>    valueInWiki = "test2"<br/>    result = objTest:checkLabelOfInternLink(link,pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : test"><span class="plainlinks">[http://example.com/link test2]</span></div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkIriOfExternLink" ..'\n'<br/>    -- function objTest:checkIriOfExternLink(labelOfExternLink, propertyOfExternLink, externLinkInWiki)<br/><br/>    pT = pr..'4'<br/>    valueInWiki = "http://example.com/test"<br/>    result = objTest:checkIriOfExternLink("test",pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value">[http://example.com/test test]</div>') ..'\n'<br/><br/>    mw.log(objTest:addPropertyWithIri(pT,"http://example.com/test"))<br/><br/>    valueInWiki = "http://example.com/test"<br/>    result = objTest:checkIriOfExternLink("test",pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">[http://example.com/test test]</div>') ..'\n'<br/><br/>    valueInWiki = "http://example.com/test2"<br/>    result = objTest:checkIriOfExternLink("test",pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : http://example.com/test">[http://example.com/test2 test]</div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkImage" ..'\n'<br/>--    function objTest:checkImage(property, valueInWiki, width, height)<br/><br/>    pT = pr..'5'<br/>    valueInWiki = "http://example.com/test.png"<br/>    result = objTest:checkImage(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value"><img src="http://example.com/test.png" /></div>') ..'\n'<br/><br/>    mw.log(objTest:addPropertyWithIri(pT,"http://example.com/test.png"))<br/><br/>    valueInWiki = "http://example.com/test.png"<br/>    result = objTest:checkImage(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><img src="http://example.com/test.png" /></div>') ..'\n'<br/><br/>    valueInWiki = "http://example.com/test2.png"<br/>    result = objTest:checkImage(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : http://example.com/test.png"><img src="http://example.com/test2.png" /></div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkTitle" ..'\n'<br/>    -- objTest:checkTitle(property, labelInWiki, tagLang)<br/><br/>    --objTest:setDebug(true)<br/>    pT = pr..'6'<br/>    local pTObjTemp1 = mw.title.new("Title1"):fullUrl()<br/>    local pTObjTemp2 = mw.title.new("Title2"):fullUrl()<br/><br/>    local ObjTemp1 = linkedwiki.new(pTObjTemp1,config);<br/>    local ObjTemp2 = linkedwiki.new(pTObjTemp2,config);<br/><br/>--    mw.log(objTest:getConfig())<br/>--    mw.log(ObjTemp1:getConfig())<br/>--    mw.log(ObjTemp2:getConfig())<br/>    mw.log(objTest:removeSubject())<br/>    mw.log(ObjTemp1:removeSubject())<br/>    mw.log(ObjTemp2:removeSubject())<br/><br/>    valueInWiki = ""<br/>    --0 in DB<br/>    result = objTest:checkTitle(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'') ..'\n'<br/><br/>    valueInWiki = "Title1;Title2"<br/>    --0 in DB<br/>    result = objTest:checkTitle(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value">[[Title1]], [[Title2]]</div>') ..'\n'<br/><br/>    valueInWiki = " Title1;Title2 "<br/>    --"Title1" in DB<br/>    -- current - pT -> pTObj<br/>    -- pTObj - rdfs:label -> "Title1"<br/>    mw.log(objTest:addPropertyWithIri(pT, pTObjTemp1))<br/>    --mw.log(ObjTemp1:addPropertyWithLitteral(rdfs.."label","Title1"))<br/>    mw.log(ObjTemp1:addPropertyString(rdfs.."label","Title1"))<br/>   -- mw.log(linkedwiki.getLastQuery())<br/>    result = objTest:checkTitle(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : Title1">[[Title2]]<span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/Title1 Title1]</span></div>') ..'\n'<br/><br/><br/>    valueInWiki = "Title1 ; Title2"<br/>    --"Title1;Title2" in DB<br/>    --"Title1" in DB<br/>    -- current - pT -> pTObj2<br/>    -- pTObj2 - rdfs:label -> "Title2"<br/>    mw.log(objTest:addPropertyWithIri(pT,pTObjTemp2))<br/>    --mw.log(objTest:addPropertyWithLitteral(rdfs.."label","Title2",nil,nil,pTObj2))<br/>    mw.log(ObjTemp2:addPropertyString(rdfs.."label","Title2"))<br/>    result = objTest:checkTitle(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/Title1 Title1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/Title2 Title2]</span></div>') ..'\n'<br/><br/>    valueInWiki = ""<br/>    --"Title1;Title2" in DB<br/>    result = objTest:checkTitle(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/Title1 Title1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/Title2 Title2]</span></div>') ..'\n'<br/><br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkUser" ..'\n'<br/>--    function objTest:checkUser(property, valueInWiki)<br/><br/><br/>    mw.log(objTest:removeSubject())<br/><br/>    pT = pr..'7'<br/><br/>    local pTObjTemp1 = mw.title.new("User:Firstname Surename1"):fullUrl()<br/>    local pTObjTemp2 = mw.title.new("User:Firstname Surename2"):fullUrl()<br/><br/>    local ObjTemp1 = linkedwiki.new(pTObjTemp1,config)<br/>    local ObjTemp2 = linkedwiki.new(pTObjTemp2,config)<br/><br/>    mw.log(objTest:removeSubject())<br/>    mw.log(ObjTemp1:removeSubject())<br/>    mw.log(ObjTemp2:removeSubject())<br/><br/>    valueInWiki = ""<br/>    --0 in DB<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'') ..'\n'<br/><br/>    valueInWiki = "User1;User2"<br/>    --0 in DB<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value">[[User:User1|User1]], [[User:User2|User2]]</div>') ..'\n'<br/><br/>    valueInWiki = ""<br/>    --"User:Firstname Surename1" in DB<br/>    -- current - pT -> pTObj<br/>    -- pTObj - rdfs:label -> "User:Firstname Surename1"<br/>    mw.log(objTest:addPropertyWithIri(pT, pTObjTemp1))<br/>    mw.log(ObjTemp1:addPropertyWithLitteral(rdfs.."label","Firstname Surename1"))<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span></div>') ..'\n'<br/><br/>    valueInWiki  = "Firstname Surename1; Firstname Surename2"<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : Firstname Surename1">[[User:Firstname Surename2|Firstname Surename2]]<span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span></div>') ..'\n'<br/><br/>     valueInWiki  = "Firstname Surename1; Firstname Surename2"<br/>    --"User:Firstname Surename1;User:Firstname Surename2" in DB<br/>    --"User:Firstname Surename2" in DB<br/>    -- current - pT -> pTObj2<br/>    -- pTObj2 - rdfs:label -> "User:Firstname Surename2"<br/>    mw.log(objTest:addPropertyWithIri(pT,pTObjTemp2))<br/>    mw.log(ObjTemp2:addPropertyWithLitteral(rdfs.."label","Firstname Surename2"))<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename2 Firstname Surename2]</span></div>') ..'\n'<br/><br/>    valueInWiki  = "Firstname Surename1; Firstname Surename2"<br/>    --"User:Firstname Surename1;User:Firstname Surename2" in DB<br/>    --"mailto:Firstname_Surename2@example.com" ADD in DB<br/>    -- current - pT -> pTObj2<br/>    -- pTObj2 - http://www.w3.org/2006/vcard/ns#email -> "mailto:Firstname_Surename2@example.com"<br/>    mw.log(ObjTemp2:addPropertyWithIri("http://www.w3.org/2006/vcard/ns#email","mailto:Firstname_Surename2@example.com"))<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename2 Firstname Surename2]</span><sub><span class="plainlinks" style="font-size: large;">[mailto:Firstname_Surename2@example.com &#9993;]</span></sub></div>') ..'\n'<br/><br/>   html = html .."RESULT BEGIN : "..'\n' ..ObjTemp2:getValue("http://www.w3.org/2006/vcard/ns#email") ..'\n'.."END" ..'\n'<br/><br/><br/><br/>    valueInWiki  = "Firstname Surename1; Firstname Surename2"<br/>    --"User:Firstname Surename1;User:Firstname Surename2" in DB<br/>    --"mailto:Firstname_Surename2@example.com" ADD in DB<br/>    -- current - pT -> pTObj2<br/>    -- pTObj2 - http://www.w3.org/2006/vcard/ns#email -> "mailto:Firstname_Surename2@example.com"<br/>    mw.log(ObjTemp2:addPropertyWithIri("http://www.w3.org/2006/vcard/ns#email","mailto:Firstname_Surename2Bis@example.com"))<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename2 Firstname Surename2]</span><sub><span class="plainlinks" style="font-size: large;">[mailto:Firstname_Surename2@example.com &#9993;]</span></sub><sub><span class="plainlinks" style="font-size: large;">[mailto:Firstname_Surename2Bis@example.com &#9993;]</span></sub></div>') ..'\n'<br/><br/>    valueInWiki = ""<br/>    --"Title1;Title2" in DB<br/>    result = objTest:checkUser(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename1 Firstname Surename1]</span>, <span class="plainlinks">[http://wiki.serverdev-mediawiki-v1/index.php/User:Firstname_Surename2 Firstname Surename2]</span><sub><span class="plainlinks" style="font-size: large;">[mailto:Firstname_Surename2@example.com &#9993;]</span></sub><sub><span class="plainlinks" style="font-size: large;">[mailto:Firstname_Surename2Bis@example.com &#9993;]</span></sub></div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/><br/>    html = html .."TEST : checkItem" ..'\n'<br/>    --    function objTest:checkItem(property, valueInWiki, tagLang)<br/><br/>    mw.log(objTest:removeSubject())<br/>   --objTest:setDebug(true)<br/><br/>    pT = pr..'8'<br/>    local wd = "http://www.wikidata.org/entity/"<br/>    local pTObjTemp1 = wd.."Q1"<br/>    local pTObjTemp2 = wd.."Q2"<br/>    local ObjTemp1 = linkedwiki.new(pTObjTemp1,config)<br/>    local ObjTemp2 = linkedwiki.new(pTObjTemp2,config)<br/><br/>    mw.log(objTest:removeSubject())<br/>    mw.log(ObjTemp1:removeSubject())<br/>    mw.log(ObjTemp2:removeSubject())<br/><br/>    valueInWiki = ""<br/>    --0 in DB<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'') ..'\n'<br/><br/>    valueInWiki = "Q1 ; Q2 "<br/>    --0 in DB<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/><br/>  html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value"><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q2 Earth]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q2 Q2])</small></span>, <span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q1 universe]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q1 Q1])</small></span></div>') ..'\n'<br/><br/><br/>    valueInWiki =  ""<br/>    --"universe" in DB<br/>    -- current - pT -> pTObj<br/>    -- pTObj - rdfs:label -> "universe"<br/>    mw.log(objTest:addPropertyWithIri(pT, pTObjTemp1))<br/>    mw.log(ObjTemp1:addPropertyWithLitteral(rdfs.."label","universe"))<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/><br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q1 universe]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q1 Q1])</small></span></div>') ..'\n'<br/><br/><br/>    valueInWiki =  "Q1;Q2"<br/>    --"universe" in DB<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/><br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : universe"><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q2 Earth]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q2 Q2])</small></span><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q1 universe]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q1 Q1])</small></span></div>') ..'\n'<br/><br/>    valueInWiki = " Q1 ; Q2 "<br/>    --"Title1;Title2" in DB<br/>    --"Title1" in DB<br/>    -- current - pT -> pTObj2<br/>    -- pTObj2 - rdfs:label -> "Title2"<br/>    mw.log(objTest:addPropertyWithIri(pT,pTObjTemp2))<br/>    mw.log(ObjTemp2:addPropertyWithLitteral(rdfs.."label","Earth"))<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q2 Earth]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q2 Q2])</small></span>, <span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q1 universe]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q1 Q1])</small></span></div>') ..'\n'<br/><br/>    valueInWiki = ""<br/>    --"Title1;Title2" in DB<br/>    result = objTest:checkItem(pT,valueInWiki)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal"><span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q2 Earth]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q2 Q2])</small></span>, <span class="plainlinks">[https://www.wikidata.org/wiki/Special:GoToLinkedPage/enwiki/Q1 universe]</span><span class="plainlinks"><small>([http://www.wikidata.org/entity/Q1 Q1])</small></span></div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : printDateInWiki" ..'\n'<br/>    --Linkedwiki:printDateInWiki(format, valueInWiki, valueInDB)<br/><br/>    local dateFormat = "d M Y"<br/>    --  {{#time:d M Y|2004-12-06}}<br/>    --"2004-12-06"^^xsd..'date'<br/>    result = objTest:printDateInWiki( "2004-12-06", "2004-12-06", dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">06 Dec 2004</div>') ..'\n'<br/><br/>    result = objTest:printDateInWiki("2004-12-07", "2004-12-06",dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : 06 Dec 2004">07 Dec 2004</div>') ..'\n'<br/><br/>    html = html .."----------------------------------------------------------------------------" ..'\n'<br/>    html = html .."TEST : checkDate" ..'\n'<br/><br/>    dateFormat = "d M Y"<br/>    local pTDate = 'http://example.com/date'<br/>    local pTDateTime = 'http://example.com/dateTime'<br/><br/>    valueInWiki = ""<br/>    --0 in DB<br/>    result = objTest:checkDate(pTDate,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'') ..'\n'<br/><br/>    valueInWiki = "2004-12-06"<br/>    --0 in DB<br/>    result = objTest:checkDate(pTDate,valueInWiki, dateFormat)<br/>    html = html .."BEGIN : "..'\n' ..valueInWiki ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div>06 Dec 2004</div>') ..'\n'<br/><br/>    valueInWiki =  ""<br/>    --"2004-12-06" in DB<br/>    -- current - pT ->  "2004-12-06"<br/>    mw.log(objTest:addProperty(pTDate,"2004-12-06",xsd..'date'))<br/>    result = objTest:checkDate(pTDate,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div>06 Dec 2004</div>') ..'\n'<br/><br/>    valueInWiki =  "2004-12-06"<br/>    --"2004-12-06" in DB<br/>    result = objTest:checkDate(pTDate,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN11 : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">06 Dec 2004</div>') ..'\n'<br/><br/>    --"2004-12-06" in DB<br/>    -- current - pT ->  "2004-12-06"<br/>    mw.log(objTest:addProperty(pTDateTime,"2004-12-06T00:00:00Z",xsd..'dateTime'))<br/>    result = objTest:checkDate(pTDateTime,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_value_equal">06 Dec 2004</div>') ..'\n'<br/><br/>    valueInWiki =  ""<br/>    --"2004-12-06T00:00:00Z" in DB<br/>    result = objTest:checkDate(pTDateTime,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div>06 Dec 2004</div>') ..'\n'<br/><br/>    valueInWiki =  "2004-12-07"<br/>    --"2004-12-06" in DB<br/>    result = objTest:checkDate(pTDate,valueInWiki, dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/><br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : 06 Dec 2004">07 Dec 2004</div>') ..'\n'<br/><br/>    local idConfigWikidata ='http://www.wikidata.org'<br/>    local taglang ='fr'<br/>    iriWikidata = wd .. "Q132845"<br/>    objWikidata = linkedwiki.new(iriWikidata,idConfigWikidata,taglang)<br/>    result = objWikidata:checkDate(wdt.."P569","1100-1-1",dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div class="linkedwiki_new_value linkedwiki_tooltip" data-toggle="tooltip" data-placement="bottom" title="Currently in DB : not a date">01 Jan 1100</div>') ..'\n'<br/><br/>    objWikidata = linkedwiki.new(iriWikidata,idConfigWikidata,taglang)<br/>    result = objWikidata:checkDate(wdt.."P569","",dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div><strong class="error">Error: Invalid time.</strong></div>') ..'\n'<br/><br/>    objWikidata = linkedwiki.new(iriWikidata,idConfigWikidata,taglang)<br/>    result = objWikidata:checkDate(wdt.."P569","Truc",dateFormat)<br/>    html = html .."RESULT BEGIN : "..'\n' ..result ..'\n'.."END" ..'\n'<br/>    html = html .."RESULT : " .. p.checkString(result,'<div>Error is not a date (0000-00-00) : Truc</div>') ..'\n'<br/><br/>--    mw.log(linkedwiki.getLastQuery())<br/>    mw.log(objTest:removeSubject())<br/><br/><br/>    --return html<br/>    return "<nowiki><pre>"..mw.text.encode( html).."</pre></nowiki>"<br/><br/>end<br/><br/>return p<br/>
	</td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>id=wpSave</td>
	<td></td>
</tr>
<tr>
	<td>open</td>
	<td>/index.php/LinkedWikiTestLua${Title}?action=edit</td>
	<td></td>
</tr>
<tr>
	<td>type</td>
	<td>id=wpTextbox1</td>
	<td>{{#invoke: LinkedWikiTest${Title} | tests}}</td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>id=wpSave</td>
	<td></td>
</tr>
<tr>
	<td>open</td>
	<td>/index.php/LinkedWikiTestLua${Title}?action=purge</td>
	<td></td>
</tr>
<tr>
	<td>clickAndWait</td>
	<td>css=input.mw-htmlform-submit</td>
	<td></td>
</tr>
<tr>
	<td>verifyText</td>
	<td>//div[@id='mw-content-text']/pre</td>
	<td>*TEST :*</td>
</tr>
<tr>
	<td>verifyNotText</td>
	<td>//div[@id='mw-content-text']/pre</td>
	<td>*KO*</td>
</tr>
</tbody></table>
</body>
</html>
